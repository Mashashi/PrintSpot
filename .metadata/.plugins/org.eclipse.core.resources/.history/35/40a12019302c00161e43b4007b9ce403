<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>

<link rel="stylesheet" href="//jqueryvalidation.org/files/demo/css/cmxform.css">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<!-- https://jqueryvalidation.org/documentation/ -->
<script src="https://jqueryvalidation.org/files/dist/jquery.validate.js"></script>
<script src="doedje-jquery.soap-1.4.2/jquery.soap.js"></script>
<script src="doedje-jquery.soap-1.4.2/xml2json.js"></script>

<script src="jquery.mobile-1.4.5/jquery.mobile-1.4.5.js"></script>
<link rel="stylesheet" href="jquery.mobile-1.4.5/jquery.mobile-1.4.5.min.css">

<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Employee Approval</title>

</head>
<body>
<script>

	String.prototype.format = function() {
	  var str = this;
	  for (var i = 0; i < arguments.length; i++) {       
	    var reg = new RegExp("\\{" + i + "\\}", "gm");             
	    str = str.replace(reg, arguments[i]);
	  }
	  return str;
	}
	
	var wsUri = "ws://"+location.host+"${pageContext.request.contextPath}/notifyRegistration";
	function connect(){
		websocket = new WebSocket(wsUri);
		websocket.onopen = function(event) { console.log("open") };
		websocket.onmessage = function(event) {
			event.data
			   
			console.log("register: "+event.data);
	    	 
			$.soap({
			    url: 'http://rafael-pc:8080/WebServices/UsersServicesService',
			    envAttributes: { 'xmlns:de': 'http://de/'},
			    appendMethodToURL : false,
			    method: 'de:get',
			    data: { id_register: event.data }
			    ,
			    beforeSend: function (SOAPEnvelope)  {
			    	console.log(SOAPEnvelope);
			    }, 
			    success: function (SOAPResponse) {
			        // do stuff with soapResponse
			        // if you want to have the response as JSON use soapResponse.toJSON();
			        // or soapResponse.toString() to get XML string
			        // or soapResponse.toXML() to get XML DOM
			        debugger;
			        var r = SOAPResponse.toJSON()["#document"]["S:Envelope"]["S:Body"]["ns2:getResponse"]["return"];
			        console.log(r);
			    },
			    error: function (SOAPResponse) {
			        // show error
			        debugger;
			        console.log(SOAPResponse)
			    }
			});
			/*$.ajax({
				url: "http://rafael-pc:8080/WebServices/UsersServicesService", 
				type: "POST",
				dataType: "xml", 
				data: soapMessage, 
				processData: false,
				contentType: "text/xml; charset=\"utf-8\"",
				success: function(){ console.log("Ok");}, 
				error: function(){ console.log("Fails");}
			});*/   
			
			
			console.log("get") 
		};
		//websocket.onclose
		//websocket.onerror
	}
	connect();
</script>




<!-- 
<ul data-role="listview" data-split-icon="gear" data-split-theme="a" data-inset="true">
    <li><a href="#"><img src="jquery.mobile-1.4.5/demos/_assets/img/album-af.jpg">
    <h2>Broken Bells</h2>
    <p>Broken Bells</p></a>
        <a href="#purchase" data-rel="popup" data-position-to="window" data-transition="pop">Purchase album</a>
    </li>
</ul>

<div data-role="popup" id="purchase" data-theme="a" data-overlay-theme="b" class="ui-content" style="max-width:340px; padding-bottom:2em;">
    <h3>Purchase Album?</h3>
<p>Your download will begin immediately on your mobile device when you purchase.</p>
    <a href="index.html" data-rel="back" class="ui-shadow ui-btn ui-corner-all ui-btn-b ui-icon-check ui-btn-icon-left ui-btn-inline ui-mini">Buy: $10.99</a>
    <a href="index.html" data-rel="back" class="ui-shadow ui-btn ui-corner-all ui-btn-inline ui-mini">Cancel</a>
</div>
-->

</body>
</html>